---
title: "powerAppResearch"
author: "Damyenn Cardenas"
date: "2023-06-15"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Testing Structure

The way items will be getting tested is

-   speed using 'profvis'
-   time between idles using 'reactlog' and 'profvis'

# Organization of Data

I will be organizing data into different levels. Each of these levels will be based on how much time and speed was changed for each individual change.

### Branch defaultWRLog

This branch is a first look at what **reactlog** can provide and how I plan to write and take information moving forward

First attempt is a Markdown table writing down time each plot renders and when the app first enter idle (When it loads for the user)

-   **Side note:** CPU scheduling information is perfect for describing and organizing data

-   Arrival Time: Time the process arrives in ready queue

-   Completion Time: Time process completes its execution

-   Burst Time: Time required by a plot to finish **Might not work for this organization**

-   Turn around time: How long to perform that process *(difference between completion and arrival time)*

-   Waiting Time: Time spend in the waiting process *(difference turn around time and burst time)* **Might not work for this organization**

```{r}
library(shiny)
library(reactlog)

reactlog_enable()

reactlogShow()

reactlogReset()

runApp("powerApp")

```

| Plot                | Arrival Time | Completion Time | Turn Around Time | Waiting Time | Connections |
|------------|------------|------------|------------|------------|------------|
| Pdist               | 0s           | 0.3246s         | 0.3246s          |              | 7           |
| Cohen               | 0.3254s      | 0.3571s         | 0.0317s          |              | 7           |
| Tdist               | 0.3576s      | 0.3910s         | 0.0334s          |              | 7           |
| First Idle Position | 0s           | 0.3915s         | 0.3915s          |              |             |

```{r}
library(shiny)
library(profvis)

profvis({
  runApp("powerApp")
})

```

Second attempt is using a new package called profvis. This tool is used for profiling and will be the direction I go moving forward

**You can rename the extension of the saved profiling files into html files. This can be helpful when it comes to presentation and just general info**

#### First Profile

| Plot        | Arrival Time | Completion Time | Turn Around Time |
|-------------|--------------|-----------------|------------------|
| Pdist       | 300ms        | 490ms           | 180ms            |
| Cohen       | 520ms        | 530ms           | 10ms             |
| Tdist       | 540ms        | 550ms           | 10ms             |
| First Idle? | 0ms          | 550ms           | 550ms            |

#### Second Profile

| Plot        | Arrival Time | Completion Time | Turn Around Time |
|-------------|--------------|-----------------|------------------|
| Pdist       | 300ms        | 510ms           | 200ms            |
| Cohen       | 520ms        | 530ms           | 10ms             |
| Tdist       | 530ms        | 560ms           | 30ms             |
| First Idle? | 0ms          | 560ms           | 560ms            |

#### Third Profile

| Plot        | Arrival Time | Completion Time | Turn Around Time |
|-------------|--------------|-----------------|------------------|
| Pdist       | 300ms        | 490ms           | 190ms            |
| Cohen       | 500ms        | 510ms           | 10ms             |
| Tdist       | 520ms        | 530ms           | 10ms             |
| First Idle? | 0ms          | 550ms           | 550ms            |

These tables show the app starting without any changes and without any interaction. As you can see the Pdist plot takes the longest as the others already done very quickly

Now I am going to mess with the different sliders to see what changes with each one. Which graph updates and how long it takes.

The first slider is: **Cohen's D**

```{r}
library(shiny)
library(profvis)

profvis({
  runApp("powerApp")
})

```

#### Cohen's D First Profile

| Plot        | Arrival Time | Completion Time | Turn Around Time |
|-------------|--------------|-----------------|------------------|
| 1st Pdist   | 310ms        | 560ms           | 240ms            |
| 1st Cohen   | 570ms        | 580ms           | 10ms             |
| 1st Tdist   | 590ms        | 600ms           | 10ms             |
| 2st Pdist   | 1660ms       | 1880ms          | 240ms            |
| 2st Cohen   | 0ms          | 0ms             | 0ms              |
| 2st Tdist   | 1900ms       | 1920ms          | 20ms             |
| First Idle  | 0ms          | 600ms           | 600ms            |
| Second Idle | 1650ms       | 1920ms          | 270ms            |

#### Cohen's D Second Profile

| Plot        | Arrival Time | Completion Time | Turn Around Time |
|-------------|--------------|-----------------|------------------|
| 1st Pdist   |              |                 |                  |
| 1st Cohen   |              |                 |                  |
| 1st Tdist   |              |                 |                  |
| 2st Pdist   |              |                 |                  |
| 2st Cohen   |              |                 |                  |
| 2st Tdist   |              |                 |                  |
| First Idle  |              |                 |                  |
| Second Idle |              |                 |                  |

#### Cohen's D Third Profile

| Plot        | Arrival Time | Completion Time | Turn Around Time |
|-------------|--------------|-----------------|------------------|
| 1st Pdist   |              |                 |                  |
| 1st Cohen   |              |                 |                  |
| 1st Tdist   |              |                 |                  |
| 2st Pdist   |              |                 |                  |
| 2st Cohen   |              |                 |                  |
| 2st Tdist   |              |                 |                  |
| First Idle  |              |                 |                  |
| Second Idle |              |                 |                  |

Trying to Optimize and figure out a way to make reactlog import or show data without having to put numbers in.

```{r}
library(shiny)
library(reactlog)

reactlog_enable()

react <- reactlog()
reactlogShow()

reactlogReset()

runApp("powerApp")

```

```{r}
#This seems to be like the way to get time differences or time in general for the reactlog
react[[1]]
print("--------------------")
react[[114]]

minTime <- react[[1]]$time
maxTime <- react[[114]]$time

time3 <- (react[[3]]$time - minTime) * 1000
time3

time4 <- (react[[4]]$time - minTime) * 1000
time4


```

Figured out how to get the time from the reactlog data. Still do not know the difference between the different labels, reactid, action, etc.

Going to try Profvis for bit due to finding documentation that seems promising.

```{r}
library(shiny)
library(profvis)

profvis({
  runApp("powerApp")
})

```

```{r}
library(profvis)

parse_rprof("Profiling/Default/first profile.Rprofvis")

```

```{r}
library(profvis)

saveProfvis <- profvis({
  runApp("powerApp")
})

```

```{r}
saveProfvis

saveProfvis$x

```

In this dataframe you can create from profvis by saving it and indexing into the first element or grabbing x. You can see all the different labels and calls, times and depth

If you look at the profile1 file. You will see .Call runs until 140ms

If you look at the .Call in the dataframe it goes until 14 in the time column.

This could be connected and might lead me to choosing profvis for writing and organizing data

Another note is that the depth and call stack starts from the top of the stack downward. The time stays the same until the next elements after the depth reaches 1.

```{r}
saveProfvis$width

saveProfvis$height

saveProfvis$sizingPolicy

saveProfvis$dependencies

saveProfvis$elementId

saveProfvis$preRenderHook

saveProfvis$jsHooks

saveProfvis$jsHooks[0]

```

Only the x element from the dataframe profvis is useful as it tells the time and details about the actual profiling

```{r}
library(shiny)
library(profvis)

saveProfvis <- profvis({
  runApp("powerApp")
})

saveProfvis

cleanProfvis <- saveProfvis$x
cleanProfvis

```

Not all the timing between labels are as clean as the one previously mentioned.

.Call in this one starts at time 3 but in the profile it is at 20ms?

Time could be done by 10 ms steps for each number in time and starts at 0ms for time = 1?

Another note is that the time jumps when nothing is going on. On row 892 and 893. The time jumps from 159 to 186 because there is nothing going on during those times I believe.

.External on line 708 and at time 50 lines up with the profile with 500ms being where .External is placed on the flame graph

.External on line 771 has time of 53

.Call on line 795 has time of 55 and I believe lines up with the 560ms .Call in Flame graph

The sys.nframe call on line 826 has time of 89 but there is no marking of this call in the flame graph?

There is a sys.nframe at 1660ms mark in the flame graph but this does not line up with the call in the dataframe

Also the labels and time do not end the same with the flame graph. The flame graph has a time and calls around the 3000ms mark and the time for the data frame ends at 205, which should be around 2040 ms, (I believe)

This can mean that the data frame is hiding information from me due to being that big or the data frame does not capture all the information from the profiling

```{r}
library(shiny)
library(profvis)

saveProfvis2 <- profvis({
  runApp("powerApp")
})

saveProfvis2

saveProfvis2$x$message$prof[900:1065,]

cleanProfvis2 <- saveProfvis2$x$message$prof
cleanProfvis2[0:901,]

```

These extra rows in the save data frame od end up creating the full flame graph. This means that once I find out how to calculate the time for the dataframe, that these data frames can be used as my markdown tables that I have been creating previously.

Also the .Call label at 915 and time 62 should be accurate if the the time column starts with 0ms = 1 time and going by 10ms

If this is correct, the way to get a ms time for the flame graph is by subtracting 1 from the time and multiplying by 10. `(time - 1) \* 10`

Then to go from the flame graph time back to the data frame should be `(time / 10) + 1`

```{r}

saveProfvis2

cleanProfvis2

#Testing that 580ms in the flame graph equals 59 time in the dataframe

cleanProfvis2[cleanProfvis2$time == 59,]

#This should have the same call stack and should show that the equations I said eariler are correct.

```

This test shows how the time works between the flame graph and the prfile that Profvis builds after each shiny app

This now allows me to take the labels that I want like the the different graph and plot names and grabbing their time and converting that into ms and puttting this all into a table to see the speed up change






















